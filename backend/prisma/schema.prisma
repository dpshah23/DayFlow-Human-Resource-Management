// prisma/schema.prisma
// This file defines your database structure
// Think of it as a blueprint for what data we'll store

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"  // Using SQLite for local development
  url      = env("DATABASE_URL")
}

// ============= USER AUTHENTICATION =============
// Stores user account information (login credentials)
model User {
  id                String     @id @default(cuid())
  email             String     @unique
  password          String     // Hashed password (never store plain text!)
  role              Role       @default(EMPLOYEE)  // ADMIN or EMPLOYEE
  isEmailVerified   Boolean    @default(false)
  isActive          Boolean    @default(true)
  createdAt         DateTime   @default(now())
  updatedAt         DateTime   @updatedAt

  // Relationship to Employee profile
  employee          Employee?

  @@index([email])
  @@index([role])
}

enum Role {
  ADMIN
  EMPLOYEE
}

// ============= EMPLOYEE PROFILE =============
// Stores detailed employee information
model Employee {
  id                String     @id @default(cuid())
  userId            String     @unique
  user              User       @relation(fields: [userId], references: [id], onDelete: Cascade)

  // Personal Information
  firstName         String
  lastName          String
  profilePicture    String?    // URL to profile image
  dateOfBirth       DateTime?
  gender            String?
  phoneNumber       String?
  personalEmail     String?
  address           String?
  city              String?
  state             String?
  zipCode           String?
  country           String?

  // Job Information
  employeeId        String     @unique  // Employee ID (e.g., EMP001)
  department        String
  position          String
  joinDate          DateTime
  reportingTo       String?    // Manager name or ID
  employmentType    String     // Full-time, Part-time, Contract

  // Salary Information
  baseSalary        Float
  currency          String     @default("USD")
  

  // Documents
  documents         Document[]
  attendance        Attendance[]
  leaveRequests     LeaveRequest[]
  payroll           Payroll[]

  createdAt         DateTime   @default(now())
  updatedAt         DateTime   @updatedAt

  @@index([employeeId])
  @@index([department])
  @@index([position])
}

// ============= DOCUMENTS =============
// Stores employee documents (certificates, IDs, etc.)
model Document {
  id                String     @id @default(cuid())
  employeeId        String
  employee          Employee   @relation(fields: [employeeId], references: [id], onDelete: Cascade)

  documentType      String     // e.g., "Passport", "Resume", "Certificate"
  fileName          String
  fileUrl           String     // URL to the document
  uploadedAt        DateTime   @default(now())
  expiryDate        DateTime?  // For documents that expire

  @@index([employeeId])
  @@index([documentType])
}

// ============= ATTENDANCE =============
// Tracks daily/weekly attendance
model Attendance {
  id                String     @id @default(cuid())
  employeeId        String
  employee          Employee   @relation(fields: [employeeId], references: [id], onDelete: Cascade)

  date              DateTime   // Date of attendance
  status            AttendanceStatus  // Present, Absent, Half-day, Leave
  checkInTime       DateTime?  // Time when employee checked in
  checkOutTime      DateTime?  // Time when employee checked out
  remarks           String?

  createdAt         DateTime   @default(now())
  updatedAt         DateTime   @updatedAt

  @@unique([employeeId, date])  // One record per employee per day
  @@index([employeeId])
  @@index([date])
  @@index([status])
}

enum AttendanceStatus {
  PRESENT
  ABSENT
  HALF_DAY
  LEAVE
}

// ============= LEAVE MANAGEMENT =============
// Handles leave applications and approvals
model LeaveRequest {
  id                String     @id @default(cuid())
  employeeId        String
  employee          Employee   @relation(fields: [employeeId], references: [id], onDelete: Cascade)

  leaveType         LeaveType  // Paid, Sick, Unpaid
  startDate         DateTime
  endDate           DateTime
  numberOfDays      Int        // Calculated from startDate and endDate
  reason            String
  remarks           String?
  status            LeaveStatus // Pending, Approved, Rejected
  approvedBy        String?    // Admin/HR name or ID
  approvalDate      DateTime?
  rejectionReason   String?

  createdAt         DateTime   @default(now())
  updatedAt         DateTime   @updatedAt

  @@index([employeeId])
  @@index([status])
  @@index([startDate])
  @@index([leaveType])
}

enum LeaveType {
  PAID
  SICK
  UNPAID
  MATERNITY
  PATERNITY
}

enum LeaveStatus {
  PENDING
  APPROVED
  REJECTED
}

// ============= PAYROLL =============
// Salary slips and payroll records
model Payroll {
  id                String     @id @default(cuid())
  employeeId        String
  employee          Employee   @relation(fields: [employeeId], references: [id], onDelete: Cascade)

  month             Int        // 1-12
  year              Int        // 2024, 2025, etc.
  baseSalary        Float
  allowances        Float      @default(0)  // HRA, DA, etc.
  deductions        Float      @default(0)  // Tax, Insurance, etc.
  netSalary         Float      // baseSalary + allowances - deductions
  status            PayrollStatus  // Generated, Approved, Paid
  paymentDate       DateTime?

  createdAt         DateTime   @default(now())
  updatedAt         DateTime   @updatedAt

  @@unique([employeeId, month, year])
  @@index([employeeId])
  @@index([status])
  @@index([year, month])
}

enum PayrollStatus {
  GENERATED
  APPROVED
  PAID
}

// ============= NOTIFICATIONS & ACTIVITY LOG =============
// Track system activities for audit and notifications
model ActivityLog {
  id                String     @id @default(cuid())
  action            String     // e.g., "Leave Approved", "Profile Updated"
  relatedTo         String?    // Employee ID or Leave Request ID
  details           String?    // Additional details
  performedBy       String?    // User who performed the action
  createdAt         DateTime   @default(now())

  @@index([relatedTo])
  @@index([createdAt])
}
